# Fish Music 使用说明

## 📖 简介

Fish Music 是一个基于 Telegram 的个人云端音乐机器人，利用 Telegram 的无限云存储来保存你的音乐收藏，随时随地收听。

**核心优势：**
- 💰 **零存储成本** - 音乐文件存在 Telegram 云端，不占你的空间
- 🚀 **一键添加** - 发送 YouTube 链接自动下载
- 🎯 **智能分类** - 支持按类型、语言、国籍筛选
- ⭐ **收藏系统** - 收藏喜欢的歌曲
- 📜 **历史记录** - 自动记录播放历史

---

## 🎵 快速开始

### 1️⃣ 搜索音乐

直接私聊机器人，发送歌曲名或歌手名：

```
周杰伦
稻香
周杰伦 稻香
```

### 2️⃣ 播放音乐

点击搜索结果中的 **"播放"** 按钮即可收听。

### 3️⃣ 浏览音乐库

发送 `/songs` 命令，随机显示 10 首歌曲供你选择。

---

## ➕ 添加音乐的三种方式

### ⭐ 方式一：YouTube 自动下载（最方便）

1. 在 YouTube 找到音乐视频
2. 复制链接发送给机器人
3. 等待自动下载完成（1-3 分钟）
4. 音乐自动添加到库中

**支持的链接：**
```
https://www.youtube.com/watch?v=xxxxx
https://youtu.be/xxxxx
```

**特点：**
- ✅ 全自动，最方便
- ✅ 自动识别歌曲信息
- ⚠️ 需要等待 1-3 分钟
- ⚠️ 部分视频可能下载失败

---

### ⭐⭐ 方式二：直接发送音频文件（最可靠）

1. 在 Telegram 选择发送文件
2. 选择音频文件
3. 发送给机器人
4. 秒速保存到音乐库

**支持的格式：**
- ✅ **MP3**（推荐，最兼容）
- ✅ **M4A**（Apple 设备常用）
- ✅ **OGG**（开源格式）
- ✅ 其他 Telegram 支持的音频格式

**文件命名规则：**
- 📁 文件名任意都可以，系统会自动识别
- 🎵 **推荐格式**：`歌手 - 歌曲名.mp3`
- 🔍 **智能识别**：如果文件名包含 ` - `，系统会自动分割识别
- 📝 **示例**：
  - ✅ `周杰伦 - 稻香.mp3` → 自动识别为：歌手「周杰伦」，歌名「稻香」
  - ✅ `周杰伦.稻香.mp3` → 自动识别为：歌手「周杰伦」，歌名「稻香」
  - ⚠️ `random_music.mp3` → 歌手和歌名都显示为文件名

**获取音频文件的方法：**
- 使用在线 YouTube 转 MP3 工具
- 从电脑已有的音乐库选择
- 从其他音乐平台下载后发送
- 使用 CD 或其他来源的音频文件

**特点：**
- ✅ 100% 成功率
- ✅ 秒速保存
- ✅ 不受平台限制
- ✅ 文件大小限制：50MB

---

### ⭐⭐⭐ 方式三：手动添加 File ID

如果你有 Telegram 文件的 File ID：

```
/add [歌曲名] [歌手名] [File_ID]
```

**示例：**
```
/add 稻香 周杰伦 AwADBwADgAD...
```

**如何获取 File ID：**
1. 向机器人 [@GetPublicIdBot](https://t.me/GetPublicIdBot) 发送音频文件
2. 机器人会返回 File ID
3. 复制 File ID 用于添加

---

## 🎮 机器人命令

| 命令 | 功能 | 说明 |
|------|------|------|
| `/start` | 🎉 欢迎信息 | 查看快速入门指南 |
| `/help` | ❓ 帮助文档 | 完整的使用说明 |
| `/songs` 或 `/list` | 🎵 浏览音乐库 | 随机显示 10 首歌曲 |
| `/random` | 🎲 随机播放 | 播放一首随机歌曲 |
| `/favorites` 或 `/favs` | ⭐ 收藏列表 | 查看收藏的歌曲 |
| `/history` | 📜 播放历史 | 最近 20 首播放记录 |
| `/stats` | 📊 统计信息 | 音乐库统计数据 |
| `/add` | ➕ 添加教程 | 查看添加音乐的详细方法 |
| `/cookies` | 🍪 配置 Cookies | 设置 YouTube cookies（管理员）|

---

## 🎯 功能详解

### ⭐ 收藏功能

1. 播放歌曲时，点击播放卡片上的 **❤️ 收藏** 按钮
2. 使用 `/favorites` 查看收藏列表
3. 点击 **💔 取消收藏** 按钮可取消收藏

**用途**：
- 收藏喜欢的歌曲，随时查看
- 建立个人音乐收藏夹
- 方便回听

---

### 📜 历史记录

- 系统自动记录你播放过的所有歌曲
- 使用 `/history` 查看最近播放
- 方便回听之前听过的歌

---

### 🎵 歌曲信息展示

每首歌曲会显示：

| 信息 | 说明 |
|------|------|
| 🎤 歌手 | 歌手名称 |
| 🎵 标题 | 歌曲标题 |
| 🌍 国家 | 歌手国籍（国家 Emoji） |
| 📅 年份 | 发行年份 |
| 🎼 类型 | 流行、摇滚、说唱等 |
| 💬 语言 | 华语、英语、日语等 |

---

## 🔍 搜索技巧

### 精确搜索

同时输入歌手和歌名搜索更准确：

```
周杰伦 稻香        # 推荐
```

### 模糊搜索

只输入歌手名或歌名：

```
周杰伦            # 搜索周杰伦的所有歌曲
稻香              # 搜索名为"稻音"的歌曲
```

### 群组内搜索

在任何群组中使用行内模式：

```
@BotName 关键词
```

示例：
```
@MyMusicBot 周杰伦
```

---

## 🖥️ Web 管理后台

### 访问地址

```
http://你的服务器IP:9999
```

### 默认账号

```
用户名：admin
密码：fishmusic2024
```

### 主要功能

#### 1. 📊 仪表盘
- 总歌曲数统计
- 歌手数量统计
- 缺失歌曲数量
- 今日新增统计

#### 2. 📋 歌曲列表
- 查看所有歌曲
- 搜索功能（按标题/歌手）
- **类型筛选**：流行、摇滚、说唱、民谣、电子、古典、爵士、其他
- **语言筛选**：华语、英语、日语、韩语、其他
- 分页浏览（每页 20 首）
- 编辑歌曲信息
- 删除歌曲

#### 3. ✏️ 编辑歌曲

点击"编辑"按钮可以修改：
- 歌曲标题
- 歌手名称
- 专辑名称
- **歌曲类型**（下拉选择）
- **歌曲语言**（下拉选择）
- **歌手国籍**（下拉选择，22 个国家/地区）

**支持的国家：**
🇨🇳 中国、🇯🇵 日本、🇰🇷 韩国、🇺🇸 美国、🇬🇧 英国、🇩🇪 德国、🇫🇷 法国、🇮🇹 意大利、🇪🇸 西班牙、🇷🇺 俄罗斯、🇨🇦 加拿大、🇦🇺 澳大利亚、🇧🇷 巴西、🇲🇽 墨西哥、🇮🇳 印度、🇹🇼 台湾、🇭🇰 香港、🇸🇬 新加坡、🇲🇾 马来西亚、🇹🇭 泰国、🇻🇳 越南、🇮🇩 印尼、🇵🇭 菲律宾

#### 4. 🔄 缺失歌曲补档
- 查看所有需要补档的歌曲
- 一键重新下载并上传
- 自动更新 File_ID

---

## 💡 使用场景

### 场景一：快速添加 YouTube 音乐

```
1. 在 YouTube 找到喜欢的音乐视频
2. 复制视频链接
3. 发送给 Fish Music 机器人
4. 等待下载完成（1-3 分钟）
5. 以后可以直接搜索播放
```

### 场景二：批量添加本地音乐

```
1. 在电脑上打开 Telegram
2. 选择你的 Bot
3. 点击"发送文件"
4. 选择 MP3 文件
5. 重复步骤添加更多文件
```

### 场景三：发现新音乐

```
1. 发送 /songs 命令
2. 浏览随机推荐的 10 首歌曲
3. 点击喜欢的歌曲播放
4. 遇到喜欢的立即收藏
```

### 场景四：整理收藏

```
1. 发送 /favorites 查看收藏列表
2. 播放并回顾收藏的歌曲
3. 对于不再喜欢的，点击取消收藏
4. 保持收藏列表的精简和质量
```

---

## ❓ 常见问题

### Q: 下载需要多长时间？

**A:** 通常 1-3 分钟，取决于：
- 视频大小
- 网络速度
- 服务器负载

### Q: 为什么有些视频无法下载？

**A:** 可能的原因：
- **YouTube 检测**：显示 "Sign in to confirm you're not a bot" 错误
- 视频受版权保护
- 视频太长（超过限制）
- 网络连接问题
- 视频平台限制

**解决方案：**

**方法 1：配置 Cookies（推荐）**

1. 获取 Cookie：
   - 打开 https://www.youtube.com 并登录
   - 按 `F12` → Application → Cookies
   - 找到 `__Secure-3PSID` 或 `SID`
   - 复制 Value 值

2. 发送给 Bot：
   ```
   /cookies <复制的cookie值>
   ```

3. 重启服务：
   ```bash
   docker compose restart bot
   ```

详细说明：[COOKES.md](./COOKES.md)

**方法 2：使用在线工具**

使用在线 YouTube 转 MP3 工具转换后，直接发送 MP3 文件给 Bot：
- https://y2mate.com
- https://yt1s.com

### Q: 文件大小限制是多少？

**A:** 单个音频文件最大 50MB（Telegram Bot API 限制）。

### Q: 音乐会占用我的手机空间吗？

**A:** 不会！音乐存储在 Telegram 云端，不占用本地空间。

### Q: 音乐会占用服务器空间吗？

**A:** 不会！音乐文件存储在 Telegram 云端，服务器只保存元数据（每首歌约 1KB）。

### Q: 可以在电脑上使用吗？

**A:** 可以！Telegram 桌面版同样支持所有功能。

### Q: 可以在群组中使用吗？

**A:** 可以！使用行内模式：`@BotName 关键词` 即可在任何群组中搜索播放。

### Q: 日语、韩语歌名会显示乱码吗？

**A:** 不会！系统已优化 UTF-8 多字节字符处理，完美支持中文、日语、韩语等所有语言。

### Q: 如何删除已添加的音乐？

**A:** 通过 Web 管理面板删除，或联系管理员。

### Q: 如何备份音乐库？

**A:** 音乐库的数据在两处：
1. **PostgreSQL 数据库**：定期备份数据库
2. **Telegram 云端**：音乐文件本身，由 Telegram 负责备份

数据库备份命令（管理员执行）：
```bash
docker exec fish_music_db pg_dump -U fish_music fish_music > backup.sql
```

---

## 🌟 提示与技巧

### 1. 批量添加

可以连续发送多个链接或文件，机器人会逐个处理。

### 2. 搜索技巧

同时输入歌手和歌名搜索更准确。

### 3. 收藏整理

遇到喜欢的歌立即收藏，定期整理收藏列表。

### 4. 随机发现

使用 `/songs` 或 `/random` 发现音乐库中的歌曲。

### 5. 利用 Web 面板

通过 Web 面板可以更方便地管理歌曲元数据，设置类型、语言、国籍等。

### 6. 补档功能

如果发现歌曲无法播放（显示缺失），可以通过 Web 面板的补档功能重新下载。

---

## 🎨 技术特性

- ✅ 使用 Telegram 云存储，永久保存
- ✅ 自动去重（相同链接不会重复下载）
- ✅ 元数据管理（歌手、类型、语言、国籍）
- ✅ 支持 CJK 字符（中日韩）
- ✅ 下载后自动清理临时文件
- ✅ 完整的收藏和历史记录
- ✅ Web 管理后台
- ✅ 多语言按钮显示（无乱码）

---

## 📞 获取帮助

如有问题或建议：

- 查看帮助文档：发送 `/help`
- 联系管理员：通过 Telegram 联系
- 提交问题：[GitHub Issues](https://github.com/yourusername/fish-music/issues)

---

## 🔄 更新日志

### v1.4.0 (2026-02-08)

- ✨ **新增 `/cookies` 命令**：通过 Telegram 直接配置 YouTube cookies
- 🎉 **超级简单**：无需 SSH，无需手动编辑文件
- 🔒 **安全**：仅管理员可用
- 📝 **详细说明**：命令内包含完整的使用指南
- 🐛 **优化**：YouTube 下载失败时提供友好的解决方案提示

### v1.3.0 - v1.3.2 (2026-02-08)

- ✨ 支持 YouTube cookies 认证
- 🍪 添加 cookies_file 配置选项
- 📄 添加 cookies 模板文件
- 📖 新增 COOKES.md 配置指南

### v1.2.0 (2026-02-08)

- ✨ 支持手动选择歌手国籍（22 个国家/地区）
- ✨ 歌曲列表新增"国家"列
- ✨ 智能国家代码更新
- 🐛 修复 Telegram 按钮多字节字符乱码问题

### v1.1.0 (2026-02-08)

- ✨ 添加 `/songs` 命令浏览音乐库
- ✨ 歌曲支持类型和语言分类
- ✨ Web 后台添加筛选功能

### v1.0.0 (2026-02-07)

- ✅ 基础 Bot 功能
- ✅ YouTube 自动下载
- ✅ Web 管理后台
- ✅ 收藏和历史记录

---

**🎵 享受你的云端音乐体验！**

Made with ❤️ by Fish Music Team
